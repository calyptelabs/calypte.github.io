<!DOCTYPE html>
<html lang="en">
  <head>
	<meta name="description" content="">
	<meta name="author" content="">
	<title>Calypte Cache</title>
	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="../../favicon.ico">

<!-- Bootstrap core CSS -->
<link href="./lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<link href="./lib/assets/css/ie10-viewport-bug-workaround.css"
	rel="stylesheet">

<!-- Custom styles for this template -->
<link href="./lib/offcanvas/css/offcanvas.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
<script src="./lib/assets/js/ie-emulation-modes-warning.js"></script>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<script type="text/javascript" src="./lib/SyntaxHighlighter/scripts/shCore.js"></script>
<script type="text/javascript" src="./lib/SyntaxHighlighter/scripts/shBrushJScript.js"></script>
<script type="text/javascript" src="./lib/SyntaxHighlighter/scripts/shBrushJava.js"></script>
<script type="text/javascript" src="./lib/SyntaxHighlighter/scripts/shBrushPhp.js"></script>
<script type="text/javascript" src="./lib/SyntaxHighlighter/scripts/shBrushXml.js"></script>
<script type="text/javascript" src="./lib/SyntaxHighlighter/scripts/shBrushBash.js"></script>
<link type="text/css" rel="stylesheet" href="./lib/SyntaxHighlighter/styles/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>
    
<style>
<!--
a[name]{
	float: inherit; 
	margin-top: -60px;
}

.menu li{
	list-style-type: none;
	margin-left: -30px;
    display: list-item;
    text-align: -webkit-match-parent;
}
.menu li > a{
    display: block;
    padding: 2px 2px;
    font-size: 13px;
    font-weight: 500;
    color: #767676;
    cursor: pointer;
}

-->
</style>     
  </head>

  <body>
	<nav class="navbar navbar-fixed-top navbar-inverse">
<div class="container">
<div class="navbar-header">
<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="#">Calypte</a>
</div>
<div id="navbar" class="collapse navbar-collapse">
<ul class="nav navbar-nav">
<li class="active"><a href="index.php">Início</a></li>
<li><a href="download.php">Download</a></li>
<!-- <li><a href="changelog.php">ChangeLog</a></li> -->
</ul>
</div><!-- /.nav-collapse -->
</div><!-- /.container -->
</nav><!-- /.navbar -->
 

    <div class="container">

      <div class="row row-offcanvas row-offcanvas-left">

        <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar">
			<div class="panel-group" id="accordion">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
        Instalação</a>
      </h4>
    </div>
    <div id="collapse1" class="panel-collapse collapse in">
      <div class="panel-body">
		<ul class="menu">
			<li><a href="install.php">Pré-requisitos</a></li>
			<li><a href="install.php#obtendo_os_arquivos_binarios">Obtendo os arquivos binários</a></li>
			<li><a href="install.php#instalando_o_pacote_binario">Instalando o pacote binário</a></li>
			<li><a href="install.php#instalando_no_windows">Instalando no windows</a></li>
			<li><a href="install.php#teste_basico_de_instalacao">Teste básico de instalação</a></li>
			<li><a href="install.php#estrutura_de_diretorios">Estrutura de diretórios</a></li>
			<li><a href="install.php#arquivo_de_configuracao">Arquivo de configuração</a></li>
		</ul>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
        Manipulação de dados</a>
      </h4>
    </div>
    <div id="collapse2" class="panel-collapse collapse">
      <div class="panel-body">
      
		<ul class="menu">
			<li><h5>Adicionando itens</h5></li>
			<li><a href="commands.php">Comando put</a></li>
			<li><a href="commands.php#replace">Comando replace</a></li>
			<li><a href="commands.php#set">Comando set</a></li>
			<li><h5>Recuperando itens</h5></li>
			<li><a href="commands.php#get">Comando get</a></li>
			<li><h5>Removendo itens</h5></li>
			<li><a href="commands.php#remove">Comando remove</a></li>
		</ul>
      
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
        Transações</a>
      </h4>
    </div>
    <div id="collapse3" class="panel-collapse collapse">
      <div class="panel-body">
		<ul class="menu">      
			<li><a href="transaction.php">Níveis de isolamento suportados</a></li>
			<li><a href="transaction.php#iniciando_uma_transacao">Iniciando uma transação</a></li>
			<li><a href="transaction.php#begin">Comando begin</a></li>
			<li><a href="transaction.php#commit">Comando commit</a></li>
			<li><a href="transaction.php#rollback">Comando rollback</a></li>
			<li><a href="transaction.php#modo_de_confirmacao_automatica">Modo de confirmação automática</a></li>
			<li><a href="transaction.php#evitando_a_leitura_fantasma_e_leitura_nao_repetitiva">Evitando a leitura fantasma e leitura não repetitiva</a></li>
		</ul>
      
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse4">
        Calypte em aplicações PHP</a>
      </h4>
    </div>
    <div id="collapse4" class="panel-collapse collapse">
      <div class="panel-body">
		<ul class="menu">      
			<li><a href="php.php">Instalação</a></li>
			<li><a href="php.php#maniputacao_de_dados">Manipulação de dados</a></li>
			<li><h5>Adicionando itens</h5></li>
			<li><a href="php.php#put">Função put</a></li>
			<li><a href="php.php#replace">Função replace</a></li>
			<li><a href="php.php#replace">Função replaceValue</a></li>
			<li><a href="php.php#set">Função set</a></li>
			<li><h5>Recuperando itens</h5></li>
			<li><a href="php.php#get">Função get</a></li>
			<li><h5>Removendo itens</h5></li>
			<li><a href="php.php#remove">Função remove</a></li>
			<li><a href="php.php#remove">Função removeValue</a></li>
			<li><h5>Transação</h5></li>
			<li><a>Iniciando uma transação</a></li>
			<li><a href="php.php#begin">Função begin</a></li>
			<li><a href="php.php#commit">Função commit</a></li>
			<li><a href="php.php#rollback">Função rollback</a></li>
			<li><a href="php.php#setautocommit">Funcão setAutoCommit</a></li>
			<li><a href="php.php#evitando_a_leitura_fantasma_e_a_leitura_nao_repetitiva">Evitando a leitura fantasma e leitura não repetitiva</a></li>
		</ul>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse5">
        Calypte em uma aplicação Java</a>
      </h4>
    </div>
    <div id="collapse5" class="panel-collapse collapse">
      <div class="panel-body">
		<ul class="menu">      
			<li><a href="java.php">Instalação</a></li>
			<li><a href="java.php#manipulacao_de_dados">Manipulação de dados</a></li>
			<li><h5>Adicionando itens</h5></li>
			<li><a href="java.php#put">Método put</a></li>
			<li><a href="java.php#replace">Método replace</a></li>
			<li><a href="java.php#set">Método set</a></li>
			<li><h5>Recuperando itens</h5></li>
			<li><a href="java.php#get">Método get</a></li>
			<li><h5>Removendo itens</h5></li>
			<li><a href="java.php#remove">Método remove</a></li>
			<li><h5>Transação</h5></li>
			<li><a href="java.php#iniciando_uma_transacao">Iniciando uma transação</a></li>
			<li><a href="java.php#begin">Método begin</a></li>
			<li><a href="java.php#commit">Método commit</a></li>
			<li><a href="java.php#rollback">Método rollback</a></li>
			<li><a href="java.php#setautocommit">Método setAutoCommit</a></li>
			<li><a href="java.php#evitando_a_leitura_fantasma_e_leitura_nao_repetitiva">Evitando a leitura fantasma e leitura não repetitiva</a></li>
		</ul>
      </div>
    </div>
  </div>
  <!-- 
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse6">
        Calypte em uma aplicação Node.js</a>
      </h4>
    </div>
    <div id="collapse6" class="panel-collapse collapse">
      <div class="panel-body">
		<ul class="menu">      
			<li><a>Instalando o cliente</a></li>
			<li><h5>Adicionando itens</h5></li>
			<li><a>O comando put</a></li>
			<li><a>O comando replace</a></li>
			<li><a>O comando set</a></li>
			<li><h5>Recuperando itens</h5></li>
			<li><a>O comando get</a></li>
			<li><h5>Removendo itens</h5></li>
			<li><a>O comando remove</a></li>
			<li><h5>Transação</h5></li>
			<li><a>Iniciando uma transação</a></li>
			<li><a>O comando begin</a></li>
			<li><a>O comando commit</a></li>
			<li><a>O comando rollback</a></li>
			<li><a>Modo de confirmação automática</a></li>
			<li><a>Evitando a leitura fantasma e leitura não repetitiva</a></li>
		</ul>
      </div>
    </div>
  </div>  
   -->
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse7">
        Aplicações Laravel com Calypte</a>
      </h4>
    </div>
    <div id="collapse7" class="panel-collapse collapse">
      <div class="panel-body">
		<ul class="menu">      
			<li><a href="laravel.php">Instalação</a></li>
			<li><a href="laravel.php#configuracao_do_cache_php">Configuração do cache.php</a></li>
			<li><a href="laravel.php#configuracao_do_app_php">Configuração do app.php</a></li>
			<li><a href="laravel.php#configuracao_do__env">Configuração do .env</a></li>
		</ul>
      </div>
    </div>
  </div>  
</div> 
        </div><!--/.sidebar-offcanvas-->

        <div class="col-xs-12 col-sm-9">
			<h1>Calypte em aplicações Java</h1>

<p>Calypte é uma ótima opção de cache para aplicações Java.
Ele é extremamente rápido, trabalha bem com pouca memória, permite o armazenamento
de dados em memória secundária e tem suporte transacional.</p>

<a name="instalacao"></a>
<h2>Instalação</h2>

<p>O Calypte pode ser instalado usando o <a href="https://maven.apache.org/">Maven</a> ou
fazendo o download dos binários e configurando-o no classpath da aplicação. 
<p>Se for utilizado o <a href="https://maven.apache.org/">Maven</a>, deve ser informado no 
<code>pom.xml:</code></p>
<pre class="brush: xml;">&lt;dependency&gt;
	&lt;groupId&gt;calypte&lt;/groupId&gt;
	&lt;artifactId&gt;jcalypte&lt;/artifactId&gt;
	&lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;</pre>

<a name="manipulacao_de_dados"></a>
<h2>Manipulação de dados</h2>

<p>As operações no cache são feitas com o uso da classe 
<code>CalypteConnection</code>. Ela fica localizada no pacote <code>calypte</code> e é
obtida a partir de uma instância da <code>CalypteConnectionPool</code>.</p>

<p><code>CalypteConnection</code> possui os seguintes métodos:</p>
<pre class="brush: java;">public interface CalypteConnection {
    
	void close() throws CacheException;
    
	boolean isClosed();
    
	boolean replace(
	String key, Object value, long timeToLive, long timeToIdle) throws CacheException;
    
	boolean replace(
	String key, Object oldValue, 
	Object newValue, long timeToLive, long timeToIdle) throws CacheException;
	
	Object putIfAbsent(
	String key, Object value, long timeToLive, long timeToIdle) throws CacheException;

	boolean set(
	String key, Object value, long timeToLive, long timeToIdle) throws CacheException;
	
	boolean put(String key, Object value, long timeToLive, 
	long timeToIdle) throws CacheException;
    
	Object get(String key, boolean forUpdate) throws CacheException;

	Object get(String key) throws CacheException;
    
	boolean remove(
	String key, Object value) throws CacheException;
    
	boolean remove(String key) throws CacheException;
    
	void setAutoCommit(boolean value) throws CacheException;
    
	boolean isAutoCommit() throws CacheException;
    
	void commit() throws CacheException;
    
	void rollback() throws CacheException;
    
	String getHost();

	int getPort();
    
}</pre>

				<ul>
					<li>close(): fecha a conexão com o servidor;</li>
					<li>isClosed(): verifica se a conexão está fechada;</li>
					<li>replace(): substitui o valor associado à chave somente se
						ele existir;</li>
					<li>replaceValue(): substitui o valor associado à chave
						somente se ele for igual a um determinado valor;</li>
					<li>putIfAbsent(): associa o valor à chave somente se a chave
						não estiver associada a um valor;</li>
					<li>put(): associa o valor à chave;</li>
					<li>set(): associa o valor à chave somente se a chave não
						estiver associada a um valor;</li>
					<li>get(): obtém o valor associado à chave bloqueando ou não
						seu acesso as demais transações;</li>
					<li>remove(): remove o valor associado à chave;</li>
					<li>removeValue(): remove o valor associado à chave somente se
						ele for igual a um determinado valor;</li>
					<li>setAutoCommit(): define o modo de confirmação automática;</li>
					<li>isAutoCommit(): obtém o estado atual do modo de
						confirmação automática;</li>
					<li>commit(): confirma todas as operações da transação atual e
						libera todos os bloqueios detidos por essa conexão;</li>
					<li>rollback(): desfaz todas as operações da transação atual e
						libera todos os bloqueios detidos por essa conexão;</li>
					<li>getHost(): obtém o endereço do servidor;</li>
					<li>getPort(): obtém a porta do servidor.</li>
				</ul>

				<p>A <code>CalypteConnectionPool</code> faz o gerênciamento e provê as conexões com o cache. 
				Ele mantém uma certa quantidade de conexões ativas e limita a criação de novas conexões
				reutilizando as conexôes atualmente ativas. Isto permite uma melhor utilizações dos recursos.</p>
				
				<p><code>CalypteConnectionPool</code> possui os seguintes métodos:</p>
				
				<pre class="brush: java;">public class CalypteConnectionPool {
    
	public CalypteConnection getConnection() throws CacheException {...}

	public CalypteConnection tryGetConnection(long l, 
	TimeUnit tu) throws CacheException {...}
    
	public void shutdown() {...}
				
}</pre>

				<ul>
					<li>getConnection(): obtém uma conexão;</li>
					<li>tryGetConnection(): tenta obter uma conexão esperando um determinado período de tempo;</li>
					<li>shutdown(): destrói o pool de conexões;</li>
				</ul>

				<pre class="brush: java;">CalypteConnectionPool pool = new CalypteConnectionPool("localhost", 1044, 1, 50);
CalypteConnection con = null;
try{
	con = pool.getConnection();
	...
	con.put(key, value, 0, 0);
}
finally{
	if(con != null){
		con.close();
	}
}</pre>

				<p>Também é possível criar uma conexâo direta com o cache. Nesse caso, ela não será gerênciada!</p>
				<pre class="brush: java;">CalypteConnection con = new CalypteConnectionImp(SERVER_HOST, SERVER_PORT);
...
con.close();
</pre>

				<h2>Adicionando itens</h2>
				
				<p>São oferecidos vários métodos para inserir um item no cache. 
				Cada um com sua particularidade.</p>
				
				<a name="put"></a>
				<h3>Método put</h3>
				
				<p>O método <code>put</code> associa um valor a uma chave, mesmo que ela exista. 
				Retorna <code>true</code>, se o valor for substituido, ou 
				<code>false</code>, se não existir um valor associado à chave.</p>

				<pre class="brush: java;">if(con.put(key, value)){
    System.out.println("replaced");
}
else{
    System.out.println("stored");
}
</pre>

				<a name="replace"></a>
				<h3>Método replace</h3>
				
				<p>O método <code>replace</code> substitui o valor associado à chave somente 
				se ele existir. Ele retorna <code>true</code>, se o valor for substituído, ou 
				<code>false</code>, se o valor não for armazenado.</p>
				<pre class="brush: java;">if(con.replace(key, value)){
    System.out.println("replaced");
}
else{
    System.out.println("not stored");
}</pre>

				<p>Também é possível substituir o valor associado à chave somente se ele for igual a 
				um determinado valor.</p>
				<pre class="brush: java;">if(con.replace(key, oldValue, value)){
    System.out.println("replaced");
}
else{
    System.out.println("not stored");
}</pre>

				<a name="putifabsent"></a>
				<h3>Método putIfAbsent</h3>
				
				<p>O método <code>putIfAbsent</code> associa o valor à chave somente se a chave não estiver
				 associada a um valor. Retorna o valor associado à chave ou <code>null</code>, se não existir 
				 um valor associado à chave. Esse método tem uma particularidade. Quando existe um valor associado 
				 à chave, o mesmo é retornado, mas será lançada uma exceção se ele expirar no momento em que 
				 for recuperado.</p>
				<pre class="brush: java;">try{
    Object currentValue = con.putIfAbsent(key, value);
    if(currentValue == null){
        System.out.println("stored");
    }
    else{
        System.out.println("not stored");
    }
}
catch(CacheException $e){
    if(e.getCode() == 1030){
        //o valor atual expirou
    }
    throw e;
}</pre>

				<a name="set"></a>
				<h3>Método set</h3>
				
				<p>O método <code>set</code> associa o valor à chave somente se a chave não estiver associada a um 
				valor. Ele retorna <code>true</code>, se o valor for associado à chave, ou <code>false</code>, se 
				ele for descartado.</p>
				<pre class="brush: java;">if(con.set(key, value)){
     System.out.println("stored");
}
else{
     System.out.println("not stored");
}</pre>

				<h2>Obtendo itens</h2>
				
				<a name="get"></a>
				<h3>Método get</h3>
				
				<p>Um valor é obtido com o uso do método <code>get</code>. 
				Ele retorna o valor associado à chave ou <code>null</code>,
				se não existir um valor associado.</p>
				<pre class="brush: java;">Object value = con.get(key);

if(value != null){
     System.out.println("value exists");
}
else{
     System.out.println("value not found");
}</pre>

				<h2>Removendo itens</h2>
				
				<p>São oferecidos vários métodos para remover um item do cache.</p>
				
				<h3 id="remove">Método remove</h3>
				
				<p>O método <code>remove</code> apaga o valor associado à chave. Ele retorna <code>true</code>, 
				se o valor for removido, ou <code>false</code>, se ele não existir.</p>
				<pre class="brush: java;">if(con.remove(key)){
    System.out.println("removed");
}
else{
    System.out.println("not found");
}</pre>

				<p>Também é possível remover o valor assoiado à chave somente se ele for igual a 
				um determinado valor.</p>
				<pre class="brush: java;">if(con.remove(key, value)){
    System.out.println("removed");
}
else{
    System.out.println("not found");
}</pre>

				<a name="iniciando_uma_transacao"></a>
				<h2>Iniciando uma transação</h2>
				
				<p>Uma transação é iniciada com o uso do método
				<code>setAutoCommit()</code> com o parâmetro igual a false e finalizada com o
				método <code>commit()</code>, <code>rollback()</code> ou <code>setAutoCommit()</code> 
				com o parâmetro <code>true</code>.</p>
				
				<a name="setautocommit"></a>
				<h3>Método setAutoCommit</h3>
				<p>O método <code>setAutoCommit()</code> define o modo de confirmação
				automática. Se o modo de confirmação automática estiver ligado,
				todas as operações serão tratadas como transações individuais. Caso
				contrário, as operações serão agrupadas em uma transação que
				deve ser confirmada com o método <code>commit()</code> ou descartadas com o
				método <code>rollback</code>. Por padrão, cada nova conexão inicia com
				o modo de confirmação automática ligada.</p>
				<pre class="brush: java;">//inicia a transação desligando o modo de confirmação automática.
con.setAutoCommit(false);
...
//confirma todas as operações ligando o modo de confirmação automática.
con.setAutoCommit(true);
</pre>

				<a name="commit"></a>
				<h3>Método commit</h3>
				<p>O método <code>commit()</code> confirma todas as operações da transação
				atual e libera todos os bloqueios detidos pela atual sessão.</p>
				<pre class="brush: java;">//inicia a transação.
con.setAutoCommit(false);
...
//confirma todas as operações.
con.commit();</pre>

				<a name="rollback"></a>
				<h3>Método rollback</h3>
				<p> O método <code>rollback()</code> desfaz todas as operações da transação
				atual e libera todos os bloqueios detidos pela atual sessão.</p>
				<pre class="brush: java;">try{
    //inicia a transação.
    con.setAutoCommit(false);
    ...
    //confirma todas as operações.
    con.commit();
}
catch(Exception e){
    //Desfaz todas as operações.
    con.rollback();
}</pre>

				<a name="evitando_a_leitura_fantasma_e_leitura_nao_repetitiva"></a>
				<h3>Evitando a leitura fantasma e leitura não repetitiva</h3>
				
				<p>Para resolver o problema de leitura fantasma e leitura não
				repetitiva, é oferecida a opção de bloquear um determinado
				item no momento de sua seleção. A opção é o parâmetro forUpdate do
				método get.</p><p>No exemplo abaixo, depois que o método <code>get()</code> é
				executado, o item key fica bloqueado até que o método <code>commit()</code> ou
				<code>rollback()</code> seja executado.</p>
				<pre class="brush: java;">try{
    //inicia a transação.
    con.setAutoCommit(false);
    //bloqueia o item key.
    value = con.get(key, true);
    if(value != null &amp;&amp; value.equals(value2)){
        //remove o item key se existir e for igual ao valor 'val'
        con.remove(key);
    }
    //confirma todas as operações.
    con.commit();
}
catch(Exception e){
    //Desfaz todas as operações.
    con.rollback();
}</pre>
 
        </div><!--/.col-xs-12.col-sm-9-->

      </div><!--/row-->

      <hr>

      <footer>
        <p>&copy; 2018 Calypte Labs.</p>
      </footer>

    </div><!--/.container-->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="./lib/assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="./lib/bootstrap/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="./lib/assets/js/ie10-viewport-bug-workaround.js"></script>
    <script src="./lib/offcanvas/js/offcanvas.js"></script>
  </body>
</html>
